# 工具函数

<cite>
**本文档中引用的文件**  
- [toany.go](file://convertx/toanyx/toany.go)
- [toany_test.go](file://convertx/toanyx/toany_test.go)
- [slicex.go](file://sliceX/slicex.go)
- [contains.go](file://sliceX/contains.go)
- [diff.go](file://sliceX/diff.go)
- [map.go](file://sliceX/map.go)
- [mapFind.go](file://sliceX/mapFind.go)
- [queue.go](file://sliceX/queueX/queue.go)
- [queue_test.go](file://sliceX/queueX/queue_test.go)
- [passwordx.go](file://hashx/passwdX/passwordx.go)
- [passwordx_test.go](file://hashx/passwdX/passwordx_test.go)
- [ip.go](file://netX/ip.go)
</cite>

## 目录
1. [简介](#简介)
2. [类型转换工具（toanyx）](#类型转换工具toanyx)
3. [切片操作工具（sliceX）](#切片操作工具sliceX)
4. [并发安全队列（queueX）](#并发安全队列queuex)
5. [密码学工具（passwdX）](#密码学工具passwdx)
6. [网络工具（ip.go）](#网络工具ipgo)
7. [总结](#总结)

## 简介
本项目提供了一系列通用、高性能的工具函数，作为项目的基础支撑模块。这些工具函数涵盖了类型安全转换、切片操作、并发安全数据结构、密码哈希处理以及网络IP地址获取等核心功能。所有模块均采用Go语言编写，具备良好的可复用性，可被项目其他模块或外部项目直接引用，显著提升开发效率和代码质量。

## 类型转换工具（toanyx）

`toanyx` 模块提供了安全、泛型化的类型转换功能，支持多种数据类型之间的转换，包括基础类型、时间类型、切片和映射等。该模块通过泛型约束和注册机制，确保了类型转换的安全性和扩展性。

核心功能包括：
- 支持 `int`、`uint`、`float`、`string`、`bool` 等基础类型的相互转换
- 支持 `time.Time` 和 `time.Duration` 的解析与转换
- 支持 `[]string`、`[]int`、`[]int64`、`[]float64` 等切片类型的转换
- 支持 `map[string]string`、`map[string]any` 以及 `[]map[string]any` 的复杂结构转换
- 提供 `ToAny` 函数，返回转换结果和成功标志，避免 panic

该模块在转换过程中会进行类型检查和边界验证，确保转换的安全性。例如，在字符串转整数时会使用 `strconv.ParseInt` 进行解析，失败时返回 `false`；在浮点数转整数时会检查溢出情况。

**Section sources**
- [toany.go](file://convertx/toanyx/toany.go#L29-L580)
- [toany_test.go](file://convertx/toanyx/toany_test.go#L8-L31)

## 切片操作工具（sliceX）

`sliceX` 模块提供了一系列针对切片的常用操作函数，极大地简化了切片数据的处理逻辑。

### 基础操作函数
- `Contains`：判断切片中是否包含指定元素
- `ContainsAny`：判断切片中是否包含另一个切片中的任意元素
- `ContainsAll`：判断切片中是否包含另一个切片中的所有元素
- `DiffSet`：计算两个切片的差集，并自动去重
- `Max`、`Min`、`Sum`：分别计算切片中的最大值、最小值和求和

### 映射与过滤
- `Map`：将一个切片通过映射函数转换为另一个切片
- `FilterMap`：在映射的同时进行过滤，只有满足条件的元素才会被保留
- `ToMap` 和 `ToMapV`：将切片转换为映射，支持自定义键值提取函数

### 高级查找功能
- `MapKeyFind`：支持在嵌套的 `map[string]any` 结构中通过路径查找值，支持精确匹配、通配符（`*`）和模糊匹配
- 支持路径如 `user.name`（精确）、`users.*.name`（通配展开）、`users.*name`（后缀匹配）等

这些函数均采用泛型实现，具有良好的类型安全性和性能表现。

**Section sources**
- [slicex.go](file://sliceX/slicex.go#L10-L43)
- [contains.go](file://sliceX/contains.go#L4-L68)
- [diff.go](file://sliceX/diff.go#L6-L32)
- [map.go](file://sliceX/map.go#L6-L74)
- [mapFind.go](file://sliceX/mapFind.go#L16-L196)

## 并发安全队列（queueX）

`queueX` 模块实现了一个并发安全的泛型优先队列，基于 Go 标准库的 `container/heap` 包构建，并通过互斥锁保证线程安全。

### 核心特性
- **泛型支持**：可存储任意类型的元素
- **优先级控制**：通过 `less` 函数定义元素的优先级顺序
- **有界/无界**：支持创建有界（指定容量）或无界队列
- **批量操作**：支持批量入队 `EnqueueBatch`，提升性能

### 主要方法
- `Enqueue`：单个元素入队，有界队列满时返回 `false`
- `EnqueueBatch`：批量入队，返回失败的元素列表
- `Dequeue`：出队优先级最高的元素
- `Peek`：查看队首元素但不移除
- `Size`、`IsEmpty`、`IsFull`：获取队列状态
- `RemoveIf`：删除第一个满足条件的元素

该队列在内部使用 `sync.Mutex` 进行加锁，所有公共方法均为线程安全，适用于高并发场景。

```mermaid
classDiagram
class PriorityQueue[T] {
-items []T
-less func(T, T) bool
-capacity int
-lock sync.Mutex
+Enqueue(item T) bool
+EnqueueBatch(items []T) (failed []T, ok bool)
+Dequeue() (T, bool)
+Peek() (T, bool)
+Size() int
+IsEmpty() bool
+IsFull() bool
}
```

**Diagram sources**
- [queue.go](file://sliceX/queueX/queue.go#L9-L203)

**Section sources**
- [queue.go](file://sliceX/queueX/queue.go#L8-L203)
- [queue_test.go](file://sliceX/queueX/queue_test.go#L9-L208)

## 密码学工具（passwdX）

`passwdX` 模块封装了基于 `bcrypt` 算法的密码哈希和验证功能，用于安全地存储和校验用户密码。

### 核心函数
- `PasswdJiaMi`：对明文密码进行哈希加密，接受 `cost` 参数控制加密强度（推荐值为10）
- `PasswdJieMi`：验证明文密码与哈希值是否匹配

### 安全建议
- `cost` 值建议设置在 10-12 之间，平衡安全性和性能
- 明文密码长度不应超过 72 字节
- `cost` 值越高，安全性越高但计算时间越长

该模块直接调用 `golang.org/x/crypto/bcrypt` 包，确保了算法的可靠性和安全性。

**Section sources**
- [passwordx.go](file://hashx/passwdX/passwordx.go#L13-L21)
- [passwordx_test.go](file://hashx/passwdX/passwordx_test.go#L7-L19)

## 网络工具（ip.go）

`netX` 模块提供了一个简单的函数用于获取本机的对外IP地址。

### 功能说明
- `GetOutboundIP`：通过向公共DNS服务器（8.8.8.8:80）发起UDP连接，获取本地连接的IP地址
- 该方法模拟了实际网络通信的出口路径，返回的IP地址即为对外通信时使用的地址

此功能常用于服务注册、日志记录或网络诊断等场景。

**Section sources**
- [ip.go](file://netX/ip.go#L6-L15)

## 总结
本文档详细介绍了项目中的核心工具函数模块，包括类型转换、切片操作、并发队列、密码学处理和网络功能。这些工具函数设计精良、性能优异，且具备高度的可复用性，可作为基础库在各类Go项目中广泛使用，有效提升开发效率和系统稳定性。